<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Sky Dreamers – Realtime Performance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f5f6f8;
  color: #111;
}
header {
  padding: 16px 24px;
  background: #ffffff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ddd;
}
h1 {
  margin: 0;
  font-size: 22px;
}
button {
  padding: 6px 14px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
}
button.active {
  background: #1976d2;
  color: #fff;
  border-color: #1976d2;
}
.container {
  padding: 20px;
}
.cards {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 14px;
}
.card {
  background: #fff;
  border-radius: 8px;
  padding: 16px;
  text-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,.08);
}
.card h2 {
  margin: 0;
  font-size: 28px;
}
.card span {
  font-size: 13px;
  color: #555;
}
.layout {
  display: grid;
  grid-template-columns: 3fr 1fr;
  gap: 20px;
  margin-top: 24px;
}
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}
th, td {
  padding: 10px;
  border: 1px solid #000;
  text-align: center;
}
th {
  background: #fafafa;
}
.states {
  background: #fff;
  padding: 12px;
  border-radius: 8px;
}
.state {
  padding: 6px 0;
  border-bottom: 1px solid #eee;
}
.footer {
  padding: 10px;
  text-align: center;
  font-size: 12px;
  color: #777;
}
</style>
</head>

<body>

<header>
  <h1>Sky Dreamers – Realtime Performance Dashboard</h1>
  <div>
    <button onclick="setCampaign('All')" class="active">All</button>
    <button onclick="setCampaign('MVA')">MVA</button>
    <button onclick="setCampaign('Auto')">Auto</button>
    <button onclick="setCampaign('Medicare')">Medicare</button>
  </div>
</header>

<div class="container">

  <!-- SCORECARDS -->
  <div class="cards">
    <div class="card"><h2 id="submissions">0</h2><span>Submissions</span></div>
    <div class="card"><h2 id="qualified">0</h2><span>Qualified</span></div>
    <div class="card"><h2 id="notQualified">0</h2><span>Not Qualified</span></div>
    <div class="card"><h2 id="pending">0</h2><span>Pending</span></div>
    <div class="card"><h2 id="fph">0.00</h2><span>FPH</span></div>
    <div class="card"><h2 id="sph">0.00</h2><span>SPH</span></div>
  </div>

  <div class="layout">

    <!-- AGENTS TABLE -->
    <div>
      <h3>Agent Performance</h3>
      <table>
        <thead>
          <tr>
            <th>Agent</th>
            <th>Subs</th>
            <th>Qualified</th>
            <th>Not Qual</th>
            <th>FPH</th>
            <th>SPH</th>
            <th>Avg TT</th>
            <th>Last Sub</th>
          </tr>
        </thead>
        <tbody id="agentTable"></tbody>
      </table>
    </div>

    <!-- STATES -->
    <div class="states">
      <h3>State Traffic</h3>
      <div id="states"></div>
    </div>

  </div>

</div>

<div class="footer">
  Live • Updates automatically • Sky Dreamers © 2025
</div>

<script>
/* ================= FIREBASE CONFIG ================= */
firebase.initializeApp({
  databaseURL: "https://performance-dashboard-c7017-default-rtdb.firebaseio.com"
});

const db = firebase.database();
let DATA = null;
let CAMPAIGN = "All";

/* ================= LISTENER ================= */
db.ref("dashboard").on("value", snap => {
  DATA = snap.val();
  if (DATA) render();
});

/* ================= RENDER ================= */
function render() {
  const s = DATA.summary;

  set("submissions", s.submissions);
  set("qualified", s.qualified);
  set("notQualified", s.notQualified);
  set("pending", s.pending);
  set("fph", s.fph.toFixed(2));
  set("sph", s.sph.toFixed(2));

  renderAgents();
  renderStates();
}

/* ================= AGENTS ================= */
function renderAgents() {
  const body = document.getElementById("agentTable");
  body.innerHTML = "";

  Object.entries(DATA.agents)
    .sort((a,b) => b[1].qualified - a[1].qualified)
    .forEach(([name,a]) => {
      body.innerHTML += `
        <tr>
          <td><b>${name}</b></td>
          <td>${a.submissions}</td>
          <td>${a.qualified}</td>
          <td>${a.notQualified}</td>
          <td>${a.fph.toFixed(2)}</td>
          <td>${a.sph.toFixed(2)}</td>
          <td>${fmt(a.avgTalkTime)}</td>
          <td>${time(a.lastSubmission)}</td>
        </tr>
      `;
    });
}

/* ================= STATES ================= */
function renderStates() {
  const s = document.getElementById("states");
  s.innerHTML = "";
  Object.entries(DATA.states)
    .sort((a,b) => b[1]-a[1])
    .forEach(([st,c]) => {
      s.innerHTML += `<div class="state">${st}: ${c}</div>`;
    });
}

/* ================= HELPERS ================= */
function set(id,val){ document.getElementById(id).innerText = val; }
function fmt(sec){
  if(!sec) return "0:00";
  return `${Math.floor(sec/60)}:${String(sec%60).padStart(2,"0")}`;
}
function time(t){ return t ? new Date(t).toLocaleTimeString() : "--"; }
function setCampaign(c){
  CAMPAIGN = c;
  document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}
</script>

</body>
</html>
